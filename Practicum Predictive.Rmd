---
title: "Practicum Predictive"
author: "Team"
date: "3/27/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library}
library(tidyverse)
library(lubridate)
library(ggthemes)
library(data.table)
library(scales)
```

```{r new, cache=T}
newwo = read_csv("workorder_clean.csv", guess_max = 1500000)
```

## Data Manipulations

```{r date}
requested = newwo %>% 
  mutate(yearrequested = year(daterequested),
         monthrequested = month(daterequested),
         dayrequested = day(daterequested)) %>%
  filter(yearrequested < 2020, yearrequested > 2000) %>%
  mutate(ymrequested = make_date(yearrequested, monthrequested),
         ymdrequested = make_date(yearrequested, monthrequested, dayrequested)) %>%
  mutate(yearcompleted = year(actualcompletiondate),
         monthcompleted = month(actualcompletiondate),
         daycompleted = day(actualcompletiondate)) %>%
  filter(yearcompleted < 2020, yearcompleted > 2000) %>%
  mutate(ymcompleted = make_date(yearcompleted, monthcompleted),
         ymdcompleted = make_date(yearcompleted, monthcompleted, daycompleted))

```

```{r priorityts}
priority = requested %>% select(craftdescription, craftgroup, daterequested, datecreated, actualcompletiondate, laststatuschange, currentstatus, prioritydescription, ispreventmaint, ymrequested, ymcompleted) %>%
  filter(currentstatus %in% c("Completed", "Closed")) %>%
  filter(prioritydescription != "OTHER") %>%
  filter(!is.na(daterequested), !is.na(datecreated), !is.na(laststatuschange)) %>%
  mutate(createffi = abs(as.numeric(round((datecreated - daterequested)/3600), digits = 2)),
         totaleffi = abs(as.numeric(round((actualcompletiondate - daterequested)/3600), digits = 2)))

priority
```

## Cost Analysis

1. Subsets

```{r cost}
zerocost = newwo %>% filter(actualcosts == 0, 
                            currentstatus == "Completed") %>% 
  select(craftgroup, prioritydescription) %>%
  group_by(craftgroup) %>%
  summarize(n = n())

costdata = requested %>% filter(currentstatus %in% c("Completed", "Closed"),
                                !is.na(daterequested), 
                                !is.na(datecreated), 
                                !is.na(laststatuschange)) %>%
  filter(prioritydescription != "OTHER") %>%
  select(actualcosts, craftgroup, daterequested, actualcompletiondate, prioritydescription, ymrequested, ymcompleted) %>% 
  mutate(totaleffi = abs(as.numeric(round((actualcompletiondate - daterequested)/3600), digits = 2)))

zerocost = costdata %>% filter(actualcosts == 0)
nonzerocost = costdata %>% filter(actualcosts != 0)
normalcost = costdata %>% filter(actualcosts < 3500, actualcosts > 0)
mediumcost = costdata %>% filter(actualcosts >= 3500, actualcosts <= 10000)
highcost = costdata %>% filter(actualcosts > 10000)
```

2. Regression

```{r costreg}
regall = lm(actualcosts ~ craftgroup + totaleffi + prioritydescription, data = costdata)
summary(regall)

regnonzero = lm(actualcosts ~ craftgroup + totaleffi + prioritydescription, data = nonzerocost)
summary(regnonzero)

regnormal = lm(actualcosts ~ craftgroup + totaleffi + prioritydescription, data = normalcost)
summary(regnormal)

regmedium = lm(actualcosts ~ craftgroup + totaleffi + prioritydescription, data = mediumcost)
summary(regmedium)

reghigh = lm(actualcosts ~ craftgroup + totaleffi + prioritydescription, data = highcost)
summary(reghigh)
```

3. Time Series 


3.1. Time series by requested date to predict number of orders requested

```{r wocount}
wocount = nonzerocost  %>% group_by(ymrequested) %>% summarize(wocount = n())
```

```{r wocountts}
wocountts = ts(wocount$wocount, start = c(2001,1), end = c(2019,8), frequency = 12)
plot(wocountts)
```

```{r wocountts_testMSE_allcrafts}
train.periods <- 160
test.periods <- length(wocountts) - train.periods
cycle <- 12

wocountts.training <- ts(wocount$wocount[1:train.periods], start = c(2001,1), end = c(2019,8), frequency = 12)

wocountts.training.SESmodel <- HoltWinters(wocountts.training, beta=FALSE, gamma=FALSE)
wocountts.training.DESmodel <- HoltWinters(wocountts.training, gamma=FALSE)
wocountts.training.HWmodel <- HoltWinters(wocountts.training)

wocountts.SESmodel <- HoltWinters(wocountts,
                          alpha=wocountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
wocountts.DESmodel <- HoltWinters(wocountts, 
                          alpha=wocountts.training.DESmodel$alpha, 
                          beta=wocountts.training.DESmodel$beta, 
                          gamma=FALSE)
wocountts.HWmodel <- HoltWinters(wocountts, 
                         alpha=wocountts.training.HWmodel$alpha, 
                         beta=wocountts.training.HWmodel$beta, 
                         gamma=wocountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((wocountts.SESmodel$fitted[fit.start:fit.end] - wocountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((wocountts.DESmodel$fitted[fit.start:fit.end] - wocountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((wocountts.HWmodel$fitted[fit.start:fit.end] - wocountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_allcrafts}
plot(wocountts.HWmodel)
wocount_2020_HW = forecast(wocountts.HWmodel, 15)
plot(wocount_2020_HW, main = "Holtwinters Forecast for 2019-2020")
```

To see the craft groups, use **unique(nonzerocost$craftgroup)**

3.1.2 Plumbing 

```{r wocountts_predict_plumbing}
plumbcount = nonzerocost %>% filter(craftgroup == "PLUMBING/RESTROOM") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
#always filter first

plumbcountts = ts(plumbcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(plumbcountts)
```

```{r wocountts_testMSE_plumb}
train.periods <- 160
test.periods <- length(plumbcountts) - train.periods


plumbcountts.training <- ts(plumbcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

plumbcountts.training.SESmodel <- HoltWinters(plumbcountts.training, beta=FALSE, gamma=FALSE)
plumbcountts.training.DESmodel <- HoltWinters(plumbcountts.training, gamma=FALSE)
plumbcountts.training.HWmodel <- HoltWinters(plumbcountts.training)

plumbcountts.SESmodel <- HoltWinters(plumbcountts,
                          alpha=plumbcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
plumbcountts.DESmodel <- HoltWinters(plumbcountts, 
                          alpha=plumbcountts.training.DESmodel$alpha, 
                          beta=plumbcountts.training.DESmodel$beta, 
                          gamma=FALSE)
plumbcountts.HWmodel <- HoltWinters(plumbcountts, 
                         alpha=plumbcountts.training.HWmodel$alpha, 
                         beta=plumbcountts.training.HWmodel$beta, 
                         gamma=plumbcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((plumbcountts.SESmodel$fitted[fit.start:fit.end] - plumbcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((plumbcountts.DESmodel$fitted[fit.start:fit.end] - plumbcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((plumbcountts.HWmodel$fitted[fit.start:fit.end] - plumbcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_plumb}
plot(plumbcountts.HWmodel)
plumbcount_2020_HW = forecast(plumbcountts.HWmodel, 15)
plot(plumbcount_2020_HW, main = "Holtwinters Plumbing Forecast for 2019-2020")
```

3.1.3 Furniture 

```{r wocountts_predict_furniture}
furniturecount = nonzerocost %>% filter(craftgroup == "FURNITURES/UTILITIES/APPLIANCES") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
#always filter first

furniturecountts = ts(furniturecount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(furniturecountts)
```

```{r wocountts_testMSE_furniture}
train.periods = 160
test.periods = length(furniturecountts) - train.periods
cycle = 12

furniturecountts.training <- ts(furniturecount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

furniturecountts.training.SESmodel <- HoltWinters(furniturecountts.training, beta=FALSE, gamma=FALSE)
furniturecountts.training.DESmodel <- HoltWinters(furniturecountts.training, gamma=FALSE)
furniturecountts.training.HWmodel <- HoltWinters(furniturecountts.training)

furniturecountts.SESmodel <- HoltWinters(furniturecountts,
                          alpha=furniturecountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
furniturecountts.DESmodel <- HoltWinters(furniturecountts, 
                          alpha=furniturecountts.training.DESmodel$alpha, 
                          beta=furniturecountts.training.DESmodel$beta, 
                          gamma=FALSE)
furniturecountts.HWmodel <- HoltWinters(furniturecountts, 
                         alpha=furniturecountts.training.HWmodel$alpha, 
                         beta=furniturecountts.training.HWmodel$beta, 
                         gamma=furniturecountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((furniturecountts.SESmodel$fitted[fit.start:fit.end] - furniturecountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((furniturecountts.DESmodel$fitted[fit.start:fit.end] - furniturecountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((furniturecountts.HWmodel$fitted[fit.start:fit.end] - furniturecountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_furniture}
plot(furniturecountts.HWmodel)
furniturecount_2020_HW = forecast(furniturecountts.HWmodel, 15)
plot(furniturecount_2020_HW, main = "Holtwinters Furniture Forecast for 2019-2020")
```


3.1.3 Security 

```{r wocountts_predict_security}
securitycount = nonzerocost %>% filter(craftgroup == "HEALTH/SAFETY/SECURITY") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())

#always filter first  
  
securitycountts = ts(securitycount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(securitycountts)
```

```{r wocountts_testMSE_security}
train.periods = 160
test.periods = length(securitycountts) - train.periods
cycle = 12

securitycountts.training <- ts(securitycount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

securitycountts.training.SESmodel <- HoltWinters(securitycountts.training, beta=FALSE, gamma=FALSE)
securitycountts.training.DESmodel <- HoltWinters(securitycountts.training, gamma=FALSE)
securitycountts.training.HWmodel <- HoltWinters(securitycountts.training)

securitycountts.SESmodel <- HoltWinters(securitycountts,
                          alpha=securitycountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
securitycountts.DESmodel <- HoltWinters(securitycountts, 
                          alpha=securitycountts.training.DESmodel$alpha, 
                          beta=securitycountts.training.DESmodel$beta, 
                          gamma=FALSE)
securitycountts.HWmodel <- HoltWinters(securitycountts, 
                         alpha=securitycountts.training.HWmodel$alpha, 
                         beta=securitycountts.training.HWmodel$beta, 
                         gamma=securitycountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((securitycountts.SESmodel$fitted[fit.start:fit.end] - securitycountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((securitycountts.DESmodel$fitted[fit.start:fit.end] - securitycountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((securitycountts.HWmodel$fitted[fit.start:fit.end] - securitycountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_security}
plot(securitycountts.HWmodel)
securitycount_2020_HW = forecast(securitycountts.HWmodel, 15)
plot(securitycount_2020_HW, main = "Holtwinters Security Forecast for 2019-2020")
```

3.2. Time Series by requested date to predict total costs

```{r setupts}
costts = nonzerocost %>% 
  group_by(ymrequested) %>% 
  summarize(totalcost = sum(actualcosts))

#If the nonzerocost has extremes that ruin prediction, replace nonzerocost in 343 with normalcost
```

```{r costts}
totalts = ts(costts$totalcost, start = c(2001,1), end = c(2019,8), frequency = 12)
plot(totalts)
```
**3.1.4 Electricity/Energy **

```{r wocountts_predict_energy}
energycount = nonzerocost %>% filter(craftgroup == "ELECTRICITY/ENERGY") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
energycountts = ts(energycount$wocount, start = c(2001,1), end = c(2019,6), frequency = 12)
plot(energycountts)
```

```{r wocountts_testMSE_energy}
test.periods <- length(energycountts) - train.periods

energycountts.training <- ts(energycount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

energycountts.training.SESmodel <- HoltWinters(energycountts.training, beta=FALSE, gamma=FALSE)
energycountts.training.DESmodel <- HoltWinters(energycountts.training, gamma=FALSE)
energycountts.training.HWmodel <- HoltWinters(energycountts.training)

energycountts.SESmodel <- HoltWinters(energycountts,
                          alpha=energycountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
energycountts.DESmodel <- HoltWinters(energycountts, 
                          alpha=energycountts.training.DESmodel$alpha, 
                          beta=energycountts.training.DESmodel$beta, 
                          gamma=FALSE)
energycountts.HWmodel <- HoltWinters(energycountts, 
                         alpha=energycountts.training.HWmodel$alpha, 
                         beta=energycountts.training.HWmodel$beta, 
                         gamma=energycountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((energycountts.SESmodel$fitted[fit.start:fit.end] - energycountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((energycountts.DESmodel$fitted[fit.start:fit.end] - energycountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((energycountts.HWmodel$fitted[fit.start:fit.end] - energycountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_energy}
plot(energycountts.HWmodel)
energycount_2020_HW = forecast(energycountts.HWmodel, 15)
plot(energycount_2020_HW, main = "Holtwinters energy Forecast for 2019-2020")
```

**3.1.5 Outdoors **

```{r wocountts_predict_outdoor}
outdoorcount = nonzerocost %>% filter(craftgroup == "OUTDOORS") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
outdoorcountts = ts(outdoorcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(outdoorcountts)
```

```{r wocountts_testMSE_outdoor}
test.periods <- length(outdoorcountts) - train.periods

outdoorcountts.training <- ts(outdoorcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

outdoorcountts.training.SESmodel <- HoltWinters(outdoorcountts.training, beta=FALSE, gamma=FALSE)
outdoorcountts.training.DESmodel <- HoltWinters(outdoorcountts.training, gamma=FALSE)
outdoorcountts.training.HWmodel <- HoltWinters(outdoorcountts.training)

outdoorcountts.SESmodel <- HoltWinters(outdoorcountts,
                          alpha=outdoorcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
outdoorcountts.DESmodel <- HoltWinters(outdoorcountts, 
                          alpha=outdoorcountts.training.DESmodel$alpha, 
                          beta=outdoorcountts.training.DESmodel$beta, 
                          gamma=FALSE)
outdoorcountts.HWmodel <- HoltWinters(outdoorcountts, 
                         alpha=outdoorcountts.training.HWmodel$alpha, 
                         beta=outdoorcountts.training.HWmodel$beta, 
                         gamma=outdoorcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((outdoorcountts.SESmodel$fitted[fit.start:fit.end] - outdoorcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((outdoorcountts.DESmodel$fitted[fit.start:fit.end] - outdoorcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((outdoorcountts.HWmodel$fitted[fit.start:fit.end] - outdoorcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_outdoor}
plot(outdoorcountts.HWmodel)
outdoorcount_2020_HW = forecast(outdoorcountts.HWmodel, 15)
plot(outdoorcount_2020_HW, main = "Holtwinters Outdoor Forecast for 2019-2020")
```


**3.1.6 Vehicle/Transportation/Delivery** 

```{r wocountts_predict_transport}
transportcount = nonzerocost %>% filter(craftgroup == "VEHICLE/TRANSPORTATION/DELIVERY") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
transportcountts = ts(transportcount$wocount, start = c(2001,9), end = c(2019,3), frequency = 12)
plot(transportcountts)
```

```{r wocountts_testMSE_transport}
test.periods <- length(transportcountts) - train.periods

transportcountts.training <- ts(transportcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

transportcountts.training.SESmodel <- HoltWinters(transportcountts.training, beta=FALSE, gamma=FALSE)
transportcountts.training.DESmodel <- HoltWinters(transportcountts.training, gamma=FALSE)
transportcountts.training.HWmodel <- HoltWinters(transportcountts.training)

transportcountts.SESmodel <- HoltWinters(transportcountts,
                          alpha=transportcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
transportcountts.DESmodel <- HoltWinters(transportcountts, 
                          alpha=transportcountts.training.DESmodel$alpha, 
                          beta=transportcountts.training.DESmodel$beta, 
                          gamma=FALSE)
transportcountts.HWmodel <- HoltWinters(transportcountts, 
                         alpha=transportcountts.training.HWmodel$alpha, 
                         beta=transportcountts.training.HWmodel$beta, 
                         gamma=transportcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((transportcountts.SESmodel$fitted[fit.start:fit.end] - transportcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((transportcountts.DESmodel$fitted[fit.start:fit.end] - transportcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((transportcountts.HWmodel$fitted[fit.start:fit.end] - transportcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_transport}
#Use DES instead
plot(transportcountts.HWmodel)
transportcount_2020_HW = forecast(transportcountts.HWmodel, 15)
plot(transportcount_2020_HW, main = "Holtwinters Transport Forecast for 2019-2020")
```


**3.1.7 Cleaning/Sanitization** 

```{r wocountts_predict_clean}
cleancount = nonzerocost %>% filter(craftgroup == "CLEANING/SANITIZATION") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
cleancountts = ts(cleancount$wocount, start = c(2015,1), end = c(2019,6), frequency = 12)
plot(cleancountts)
```

```{r wocountts_testMSE_clean}
train.periods = 40
test.periods <- length(cleancountts) - train.periods

cleancountts.training <- ts(cleancount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

cleancountts.training.SESmodel <- HoltWinters(cleancountts.training, beta=FALSE, gamma=FALSE)
cleancountts.training.DESmodel <- HoltWinters(cleancountts.training, gamma=FALSE)
cleancountts.training.HWmodel <- HoltWinters(cleancountts.training)

cleancountts.SESmodel <- HoltWinters(cleancountts,
                          alpha=cleancountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
cleancountts.DESmodel <- HoltWinters(cleancountts, 
                          alpha=cleancountts.training.DESmodel$alpha, 
                          beta=cleancountts.training.DESmodel$beta, 
                          gamma=FALSE)
cleancountts.HWmodel <- HoltWinters(cleancountts, 
                         alpha=cleancountts.training.HWmodel$alpha, 
                         beta=cleancountts.training.HWmodel$beta, 
                         gamma=cleancountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((cleancountts.SESmodel$fitted[fit.start:fit.end] - cleancountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((cleancountts.DESmodel$fitted[fit.start:fit.end] - cleancountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((cleancountts.HWmodel$fitted[fit.start:fit.end] - cleancountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_clean}
plot(cleancountts.HWmodel)
cleancount_2020_HW = forecast(cleancountts.HWmodel, 15)
plot(cleancount_2020_HW, main = "Holtwinters Cleaning Forecast for 2019-2020")
```


**3.1.8 Construction/Building** 

```{r wocountts_predict_construct}
constructcount = nonzerocost %>% filter(craftgroup == "CONSTRUCTION/BUILDING") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
constructcountts = ts(constructcount$wocount, start = c(2001,9), end = c(2019,6), frequency = 12)
plot(constructcountts)
```

```{r wocountts_testMSE_construct}
train.periods = 160
test.periods <- length(constructcountts) - train.periods

constructcountts.training <- ts(constructcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

constructcountts.training.SESmodel <- HoltWinters(constructcountts.training, beta=FALSE, gamma=FALSE)
constructcountts.training.DESmodel <- HoltWinters(constructcountts.training, gamma=FALSE)
constructcountts.training.HWmodel <- HoltWinters(constructcountts.training)

constructcountts.SESmodel <- HoltWinters(constructcountts,
                          alpha=constructcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
constructcountts.DESmodel <- HoltWinters(constructcountts, 
                          alpha=constructcountts.training.DESmodel$alpha, 
                          beta=constructcountts.training.DESmodel$beta, 
                          gamma=FALSE)
constructcountts.HWmodel <- HoltWinters(constructcountts, 
                         alpha=constructcountts.training.HWmodel$alpha, 
                         beta=constructcountts.training.HWmodel$beta, 
                         gamma=constructcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((constructcountts.SESmodel$fitted[fit.start:fit.end] - constructcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((constructcountts.DESmodel$fitted[fit.start:fit.end] - constructcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((constructcountts.HWmodel$fitted[fit.start:fit.end] - constructcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_construct}
# Relook at this because of outliers
plot(constructcountts.HWmodel)
constructcount_2020_HW = forecast(constructcountts.HWmodel, 15)
plot(constructcount_2020_HW, main = "Holtwinters Construction Forecast for 2019-2020")
```


**3.1.9 Event/Recreation/Food and Beverages **

```{r wocountts_predict_event}
eventcount = nonzerocost %>% filter(craftgroup == "EVENT/RECREATION/F&B") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
eventcountts = ts(eventcount$wocount, start = c(2002,8), end = c(2019,6), frequency = 12)
plot(eventcountts)
```

```{r wocountts_testMSE_event}
test.periods <- length(eventcountts) - train.periods

eventcountts.training <- ts(eventcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

eventcountts.training.SESmodel <- HoltWinters(eventcountts.training, beta=FALSE, gamma=FALSE)
eventcountts.training.DESmodel <- HoltWinters(eventcountts.training, gamma=FALSE)
eventcountts.training.HWmodel <- HoltWinters(eventcountts.training)

eventcountts.SESmodel <- HoltWinters(eventcountts,
                          alpha=eventcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
eventcountts.DESmodel <- HoltWinters(eventcountts, 
                          alpha=eventcountts.training.DESmodel$alpha, 
                          beta=eventcountts.training.DESmodel$beta, 
                          gamma=FALSE)
eventcountts.HWmodel <- HoltWinters(eventcountts, 
                         alpha=eventcountts.training.HWmodel$alpha, 
                         beta=eventcountts.training.HWmodel$beta, 
                         gamma=eventcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((eventcountts.SESmodel$fitted[fit.start:fit.end] - eventcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((eventcountts.DESmodel$fitted[fit.start:fit.end] - eventcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((eventcountts.HWmodel$fitted[fit.start:fit.end] - eventcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_event}
plot(eventcountts.HWmodel)
eventcount_2020_HW = forecast(eventcountts.HWmodel, 15)
plot(eventcount_2020_HW, main = "Holtwinters Event Forecast for 2019-2020")
```


**3.1.10 Plant and Materials **

```{r wocountts_predict_plant}
plantcount = nonzerocost %>% filter(craftgroup == "PLANT/MATERIALS") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
plantcountts = ts(plantcount$wocount, start = c(2003,1), end = c(2019,6), frequency = 12)
plot(plantcountts)
```

```{r wocountts_testMSE_plant}
test.periods <- length(plantcountts) - train.periods

plantcountts.training <- ts(plantcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

plantcountts.training.SESmodel <- HoltWinters(plantcountts.training, beta=FALSE, gamma=FALSE)
plantcountts.training.DESmodel <- HoltWinters(plantcountts.training, gamma=FALSE)
plantcountts.training.HWmodel <- HoltWinters(plantcountts.training)

plantcountts.SESmodel <- HoltWinters(plantcountts,
                          alpha=plantcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
plantcountts.DESmodel <- HoltWinters(plantcountts, 
                          alpha=plantcountts.training.DESmodel$alpha, 
                          beta=plantcountts.training.DESmodel$beta, 
                          gamma=FALSE)
plantcountts.HWmodel <- HoltWinters(plantcountts, 
                         alpha=plantcountts.training.HWmodel$alpha, 
                         beta=plantcountts.training.HWmodel$beta, 
                         gamma=plantcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((plantcountts.SESmodel$fitted[fit.start:fit.end] - plantcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((plantcountts.DESmodel$fitted[fit.start:fit.end] - plantcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((plantcountts.HWmodel$fitted[fit.start:fit.end] - plantcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_plant}
plot(plantcountts.HWmodel)
plantcount_2020_HW = forecast(plantcountts.HWmodel, 15)
plot(plantcount_2020_HW, main = "Holtwinters Plant and Materials Forecast for 2019-2020")
```


**3.1.11 Personnel and Training **

```{r wocountts_predict_personnel}
personnelcount = nonzerocost %>% filter(craftgroup == "ADMIN/PERSONNEL/TRAINING") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
personnelcountts = ts(personnelcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(personnelcountts)
```

```{r wocountts_testMSE_personnel}
test.periods <- length(personnelcountts) - train.periods

personnelcountts.training <- ts(personnelcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

personnelcountts.training.SESmodel <- HoltWinters(personnelcountts.training, beta=FALSE, gamma=FALSE)
personnelcountts.training.DESmodel <- HoltWinters(personnelcountts.training, gamma=FALSE)
personnelcountts.training.HWmodel <- HoltWinters(personnelcountts.training)

personnelcountts.SESmodel <- HoltWinters(personnelcountts,
                          alpha=personnelcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
personnelcountts.DESmodel <- HoltWinters(personnelcountts, 
                          alpha=personnelcountts.training.DESmodel$alpha, 
                          beta=personnelcountts.training.DESmodel$beta, 
                          gamma=FALSE)
personnelcountts.HWmodel <- HoltWinters(personnelcountts, 
                         alpha=personnelcountts.training.HWmodel$alpha, 
                         beta=personnelcountts.training.HWmodel$beta, 
                         gamma=personnelcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((personnelcountts.SESmodel$fitted[fit.start:fit.end] - personnelcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((personnelcountts.DESmodel$fitted[fit.start:fit.end] - personnelcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((personnelcountts.HWmodel$fitted[fit.start:fit.end] - personnelcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_personnel}
plot(personnelcountts.HWmodel)
personnelcount_2020_HW = forecast(personnelcountts.HWmodel, 15)
plot(personnelcount_2020_HW, main = "Holtwinters Personnel Forecast for 2019-2020")
```


**3.1.12 Preventive/Scheduled** 

???? Have to check this

```{r wocountts_predict_PM}
PMcount = nonzerocost %>% filter(craftgroup == "PREVENTIVE/SCHEDULED") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
PMcountts = ts(PMcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(PMcountts)
```

```{r wocountts_testMSE_PM}
test.periods <- length(PMcountts) - train.periods

PMcountts.training <- ts(PMcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

PMcountts.training.SESmodel <- HoltWinters(PMcountts.training, beta=FALSE, gamma=FALSE)
PMcountts.training.DESmodel <- HoltWinters(PMcountts.training, gamma=FALSE)
PMcountts.training.HWmodel <- HoltWinters(PMcountts.training)

PMcountts.SESmodel <- HoltWinters(PMcountts,
                          alpha=PMcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
PMcountts.DESmodel <- HoltWinters(PMcountts, 
                          alpha=PMcountts.training.DESmodel$alpha, 
                          beta=PMcountts.training.DESmodel$beta, 
                          gamma=FALSE)
PMcountts.HWmodel <- HoltWinters(PMcountts, 
                         alpha=PMcountts.training.HWmodel$alpha, 
                         beta=PMcountts.training.HWmodel$beta, 
                         gamma=PMcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((PMcountts.SESmodel$fitted[fit.start:fit.end] - PMcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((PMcountts.DESmodel$fitted[fit.start:fit.end] - PMcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((PMcountts.HWmodel$fitted[fit.start:fit.end] - PMcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_PM}
plot(PMcountts.HWmodel)
PMcount_2020_HW = forecast(PMcountts.HWmodel, 15)
plot(PMcount_2020_HW, main = "Holtwinters PM Forecast for 2019-2020")
```


**3.1.13 Inspection** 

```{r wocountts_predict_inspect}
inspectcount = nonzerocost %>% filter(craftgroup == "INSPECTION") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
inspectcountts = ts(inspectcount$wocount, start = c(2004,9), end = c(2019,6), frequency = 12)
plot(inspectcountts)
```

```{r wocountts_testMSE_inspect}
test.periods <- length(inspectcountts) - train.periods

inspectcountts.training <- ts(inspectcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

inspectcountts.training.SESmodel <- HoltWinters(inspectcountts.training, beta=FALSE, gamma=FALSE)
inspectcountts.training.DESmodel <- HoltWinters(inspectcountts.training, gamma=FALSE)
inspectcountts.training.HWmodel <- HoltWinters(inspectcountts.training)

inspectcountts.SESmodel <- HoltWinters(inspectcountts,
                          alpha=inspectcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
inspectcountts.DESmodel <- HoltWinters(inspectcountts, 
                          alpha=inspectcountts.training.DESmodel$alpha, 
                          beta=inspectcountts.training.DESmodel$beta, 
                          gamma=FALSE)
inspectcountts.HWmodel <- HoltWinters(inspectcountts, 
                         alpha=inspectcountts.training.HWmodel$alpha, 
                         beta=inspectcountts.training.HWmodel$beta, 
                         gamma=inspectcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((inspectcountts.SESmodel$fitted[fit.start:fit.end] - inspectcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((inspectcountts.DESmodel$fitted[fit.start:fit.end] - inspectcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((inspectcountts.HWmodel$fitted[fit.start:fit.end] - inspectcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_inspect}
plot(inspectcountts.HWmodel)
inspectcount_2020_HW = forecast(inspectcountts.HWmodel, 15)
plot(inspectcount_2020_HW, main = "Holtwinters Inspection Forecast for 2019-2020")
```


**3.1.14 IT/Network** 

```{r wocountts_predict_IT}
ITcount = nonzerocost %>% filter(craftgroup == "IT/NETWORK") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
ITcountts = ts(ITcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(ITcountts)
```

```{r wocountts_testMSE_IT}
test.periods <- length(ITcountts) - train.periods

ITcountts.training <- ts(ITcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

ITcountts.training.SESmodel <- HoltWinters(ITcountts.training, beta=FALSE, gamma=FALSE)
ITcountts.training.DESmodel <- HoltWinters(ITcountts.training, gamma=FALSE)
ITcountts.training.HWmodel <- HoltWinters(ITcountts.training)

ITcountts.SESmodel <- HoltWinters(ITcountts,
                          alpha=ITcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
ITcountts.DESmodel <- HoltWinters(ITcountts, 
                          alpha=ITcountts.training.DESmodel$alpha, 
                          beta=ITcountts.training.DESmodel$beta, 
                          gamma=FALSE)
ITcountts.HWmodel <- HoltWinters(ITcountts, 
                         alpha=ITcountts.training.HWmodel$alpha, 
                         beta=ITcountts.training.HWmodel$beta, 
                         gamma=ITcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((ITcountts.SESmodel$fitted[fit.start:fit.end] - ITcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((ITcountts.DESmodel$fitted[fit.start:fit.end] - ITcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((ITcountts.HWmodel$fitted[fit.start:fit.end] - ITcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_IT}
plot(ITcountts.HWmodel)
ITcount_2020_HW = forecast(ITcountts.HWmodel, 15)
plot(ITcount_2020_HW, main = "Holtwinters IT Forecast for 2019-2020")
```


**3.1.15 Contract **

??? Check this

```{r wocountts_predict_contract}
contractcount = nonzerocost %>% filter(craftgroup == "CONTRACT") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
contractcountts = ts(contractcount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(contractcountts)
```

```{r wocountts_testMSE_contract}
test.periods <- length(contractcountts) - train.periods

contractcountts.training <- ts(contractcount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

contractcountts.training.SESmodel <- HoltWinters(contractcountts.training, beta=FALSE, gamma=FALSE)
contractcountts.training.DESmodel <- HoltWinters(contractcountts.training, gamma=FALSE)
contractcountts.training.HWmodel <- HoltWinters(contractcountts.training)

contractcountts.SESmodel <- HoltWinters(contractcountts,
                          alpha=contractcountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
contractcountts.DESmodel <- HoltWinters(contractcountts, 
                          alpha=contractcountts.training.DESmodel$alpha, 
                          beta=contractcountts.training.DESmodel$beta, 
                          gamma=FALSE)
contractcountts.HWmodel <- HoltWinters(contractcountts, 
                         alpha=contractcountts.training.HWmodel$alpha, 
                         beta=contractcountts.training.HWmodel$beta, 
                         gamma=contractcountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((contractcountts.SESmodel$fitted[fit.start:fit.end] - contractcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((contractcountts.DESmodel$fitted[fit.start:fit.end] - contractcountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((contractcountts.HWmodel$fitted[fit.start:fit.end] - contractcountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_contract}
plot(contractcountts.HWmodel)
contractcount_2020_HW = forecast(contractcountts.HWmodel, 15)
plot(contractcount_2020_HW, main = "Holtwinters Contract Forecast for 2019-2020")
```

**3.1.16 SOS**

```{r wocountts_predict_SOS}
SOScount = nonzerocost %>% filter(craftgroup == "SOS") %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
SOScountts = ts(SOScount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(SOScountts)
```

```{r wocountts_testMSE_SOS}
test.periods <- length(SOScountts) - train.periods

SOScountts.training <- ts(SOScount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

SOScountts.training.SESmodel <- HoltWinters(SOScountts.training, beta=FALSE, gamma=FALSE)
SOScountts.training.DESmodel <- HoltWinters(SOScountts.training, gamma=FALSE)
SOScountts.training.HWmodel <- HoltWinters(SOScountts.training)

SOScountts.SESmodel <- HoltWinters(SOScountts,
                          alpha=SOScountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
SOScountts.DESmodel <- HoltWinters(SOScountts, 
                          alpha=SOScountts.training.DESmodel$alpha, 
                          beta=SOScountts.training.DESmodel$beta, 
                          gamma=FALSE)
SOScountts.HWmodel <- HoltWinters(SOScountts, 
                         alpha=SOScountts.training.HWmodel$alpha, 
                         beta=SOScountts.training.HWmodel$beta, 
                         gamma=SOScountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((SOScountts.SESmodel$fitted[fit.start:fit.end] - SOScountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((SOScountts.DESmodel$fitted[fit.start:fit.end] - SOScountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((SOScountts.HWmodel$fitted[fit.start:fit.end] - SOScountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_SOS}
plot(SOScountts.HWmodel)
SOScount_2020_HW = forecast(SOScountts.HWmodel, 15)
plot(SOScount_2020_HW, main = "Holtwinters SOS Forecast for 2019-2020")
```


**3.1.17 Others** 

```{r wocountts_predict_other}
othercount = nonzerocost %>% filter(craftgroup %in% c("CODES", "OTHER", "UNCLEAR/TBD")) %>% 
  group_by(ymrequested) %>% 
  summarize(wocount = n())
othercountts = ts(othercount$wocount, start = c(2001,4), end = c(2019,6), frequency = 12)
plot(othercountts)
```

```{r wocountts_testMSE_other}
test.periods <- length(othercountts) - train.periods

othercountts.training <- ts(othercount$wocount[1:train.periods], start = c(2001,1), end = c(2019,6), frequency = 12)

othercountts.training.SESmodel <- HoltWinters(othercountts.training, beta=FALSE, gamma=FALSE)
othercountts.training.DESmodel <- HoltWinters(othercountts.training, gamma=FALSE)
othercountts.training.HWmodel <- HoltWinters(othercountts.training)

othercountts.SESmodel <- HoltWinters(othercountts,
                          alpha=othercountts.training.SESmodel$alpha, 
                          beta=FALSE, 
                          gamma=FALSE)
othercountts.DESmodel <- HoltWinters(othercountts, 
                          alpha=othercountts.training.DESmodel$alpha, 
                          beta=othercountts.training.DESmodel$beta, 
                          gamma=FALSE)
othercountts.HWmodel <- HoltWinters(othercountts, 
                         alpha=othercountts.training.HWmodel$alpha, 
                         beta=othercountts.training.HWmodel$beta, 
                         gamma=othercountts.training.HWmodel$gamma)

data.start <- train.periods + 1
data.end <- train.periods + test.periods

fit.start <- train.periods 
fit.end <- train.periods + test.periods - 1

SES.MSE <- sum((othercountts.SESmodel$fitted[fit.start:fit.end] - othercountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - 1 
fit.end <- train.periods + test.periods - 2

DES.MSE <- sum((othercountts.DESmodel$fitted[fit.start:fit.end] - othercountts[data.start:data.end])^2)/(test.periods)

fit.start <- train.periods - cycle + 1 
fit.end <- train.periods + test.periods - cycle

HW.MSE <- sum((othercountts.HWmodel$fitted[fit.start:fit.end] - othercountts[fit.start:fit.end])^2)/(test.periods)

cat(paste("SES MSE =", SES.MSE, "\nDES MSE =", DES.MSE, "\nHW MSE =", HW.MSE))
```

```{r wocountts_predict_other}
plot(othercountts.HWmodel)
othercount_2020_HW = forecast(othercountts.HWmodel, 15)
plot(othercount_2020_HW, main = "Holtwinters other Forecast for 2019-2020")
```

### 3.2. Time Series by requested date to predict total costs

```{r setupts}
costts = nonzerocost %>% 
  group_by(ymrequested) %>% 
  summarize(totalcost = sum(actualcosts))

normalcostts = normalcost %>% select(actualcosts, ymrequested)
mediumcostts = mediumcost %>% select(actualcosts, ymrequested)
highcostts = highcost %>% select(actualcosts, ymrequested)
```

```{r costts}
totalts = ts(costts$totalcost, start = c(2001,1), end = c(2019,8), frequency = 12)
plot(totalts)
```

## Priority Time Series



## Efficiency Time Series

1. Request-Created Efficiency

2. Request-Completed Efficiency
